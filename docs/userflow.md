# 블로그 체험단 SaaS — 기능단위 유저플로우

본 문서는 블로그 체험단 플랫폼 SaaS의 핵심 기능별 유저플로우를 정의합니다.
각 플로우는 **입력(Input)**, **처리(Process)**, **출력(Output)** 단계로 구성되며, 발생 가능한 엣지케이스를 포함합니다.

---

## 1. 회원가입 & 역할선택

### 1.1 입력 (Input)
- 이름 입력
- 휴대폰번호 입력
- 이메일 입력
- 약관 동의 체크박스 선택 (필수/선택 구분)
- 역할 선택 (광고주/인플루언서 라디오 버튼)
- 인증 방식 선택 (이메일/소셜 로그인)
- 비밀번호 입력 및 확인 (이메일 방식 선택 시)
- 제출 버튼 클릭

### 1.2 처리 (Process)
1. **입력값 유효성 검사**
   - 이름: 2-50자, 특수문자 제한
   - 휴대폰번호: 형식 검증 (010-XXXX-XXXX)
   - 이메일: 형식 검증 및 중복 체크
   - 비밀번호: 최소 8자, 영문+숫자+특수문자 조합
   - 약관: 필수 항목 동의 여부 확인

2. **Supabase Auth 계정 생성**
   - 이메일 방식: Auth API 호출, 비밀번호 해싱
   - 소셜 로그인: OAuth 플로우 실행 (Google/Kakao/Naver)

3. **프로필 레코드 생성**
   - `users` 테이블에 레코드 생성
   - `role` 필드에 선택된 역할 저장
   - `onboarding_completed` = false 설정

4. **약관 이력 저장**
   - `user_agreements` 테이블에 동의 내역 저장
   - 동의 시각, 약관 버전 기록

5. **이메일 검증 플로우**
   - 이메일 방식: 인증 메일 발송
   - 소셜 로그인: 이메일 자동 인증

6. **보안 처리**
   - 레이트 리밋: 동일 IP/이메일에서 5분당 최대 3회
   - 봇 방지: reCAPTCHA 또는 유사 메커니즘
   - 세션 토큰 발급 및 쿠키 저장

### 1.3 출력 (Output)
- **성공 케이스**
  - 가입 성공 토스트 메시지
  - 역할별 온보딩 페이지로 리다이렉트
    - 광고주: 광고주 정보 등록 페이지
    - 인플루언서: 인플루언서 정보 등록 페이지
  - 이메일 인증 안내 메시지 (이메일 방식)

- **실패 케이스**
  - 이메일 중복: 필드 하단 에러 메시지, 로그인 링크 제공
  - 비밀번호 정책 미충족: 실시간 체크리스트 표시
  - 필수 약관 미동의: 체크박스 에러 하이라이트
  - 네트워크 에러: 에러 토스트, 재시도 버튼

### 1.4 엣지케이스
- **EC1. 이메일 중복**
  - 처리: DB 조회 시 중복 감지
  - 출력: 에러 메시지, 로그인 페이지 링크

- **EC2. 소셜 로그인 이메일과 기존 이메일 계정 중복**
  - 처리: 동일 이메일 체크, 계정 연결 또는 안내
  - 출력: 기존 계정으로 로그인 유도 메시지

- **EC3. 레이트 리밋 초과**
  - 처리: 요청 카운트 초과 감지
  - 출력: 일시적 차단 메시지, 재시도 가능 시간 표시

- **EC4. 필수 약관 미동의**
  - 처리: 제출 시 검증
  - 출력: 해당 체크박스로 스크롤 이동, 에러 메시지

- **EC5. 봇 또는 자동화 도구 감지**
  - 처리: reCAPTCHA 실패
  - 출력: 인증 재시도 요청

---

## 2. 인플루언서 정보 등록

### 2.1 입력 (Input)
- 생년월일 선택 (날짜 피커)
- SNS 채널 정보 입력
  - 채널 유형 선택 (Naver Blog/YouTube/Instagram/Threads)
  - 채널명 입력
  - URL 입력
  - "추가" 버튼 클릭 (최소 1개, 최대 4개)
- 주요 활동 카테고리 선택 (선택 사항)
- 임시저장 버튼 클릭 (선택)
- 제출 버튼 클릭

### 2.2 처리 (Process)
1. **생년월일 검증**
   - 날짜 형식 정규화 (YYYY-MM-DD)
   - 만 14세 이상 확인 (연령 정책)
   - 미래 날짜 차단

2. **SNS 채널 URL 검증**
   - URL 형식 검증 (정규식)
   - 플랫폼별 패턴 매칭
     - Naver: `blog.naver.com/{username}`
     - YouTube: `youtube.com/@{username}` 또는 `/channel/{id}`
     - Instagram: `instagram.com/{username}`
     - Threads: `threads.net/@{username}`
   - 중복 URL 체크 (다른 사용자가 이미 등록한 URL)

3. **채널 정보 저장**
   - `influencer_profiles` 테이블 레코드 생성
   - `influencer_channels` 테이블에 각 채널 저장
   - SNS 채널 정보 JSONB 형식으로 저장

4. **비동기 검증 잡 큐잉 (선택)**
   - URL 실제 존재 여부 확인 (HEAD 요청)
   - 채널 활성 상태 확인
   - 검증 결과는 비동기로 업데이트

5. **프로필 완성 플래그**
   - `onboarding_completed` = true 업데이트

6. **메트릭 수집 (선택)**
   - 가입 경로, 선택한 채널 유형 등 분석 데이터 수집

### 2.3 출력 (Output)
- **성공 케이스**
  - 등록 완료 토스트 메시지
  - 홈페이지(`/`)로 리다이렉트
  - 환영 메시지 또는 온보딩 가이드 표시

- **진행 상태 표시**
  - 각 채널: 검증 대기 → 검증 성공/실패 상태 표시
  - 비동기 검증 완료 시 프로필 페이지에서 확인 가능

- **실패 케이스**
  - URL 형식 오류: 필드 하단 에러 메시지
  - 중복 URL: 경고 메시지 (이미 등록된 채널)
  - 최소 채널 미입력: 에러 메시지 (최소 1개 이상)
  - 만 14세 미만: 서비스 이용 불가 안내

### 2.4 엣지케이스
- **EC1. SNS 채널 미입력 (최소 1개 필수)**
  - 처리: 제출 시 채널 개수 체크
  - 출력: 에러 메시지, 채널 추가 섹션으로 포커스

- **EC2. 중복 URL 등록 시도**
  - 처리: DB에서 동일 URL 존재 확인
  - 출력: 경고 메시지 (다른 사용자가 사용 중)

- **EC3. 동일 채널 중복 추가**
  - 처리: 클라이언트에서 중복 체크
  - 출력: 토스트 메시지 (이미 추가된 채널)

- **EC4. 만 14세 미만**
  - 처리: 생년월일 기준 연령 계산
  - 출력: 에러 메시지, 제출 차단

- **EC5. URL 비활성 또는 존재하지 않음 (비동기 검증)**
  - 처리: 백그라운드 검증 실패
  - 출력: 프로필에서 경고 표시, 재확인 요청

- **EC6. 임시저장 후 페이지 이탈**
  - 처리: 로컬스토리지 또는 DB에 draft 저장
  - 출력: 재진입 시 복원 옵션 제공

---

## 3. 광고주 정보 등록

### 3.1 입력 (Input)
- 업체명 입력
- 위치/주소 입력 (주소 검색 API 또는 직접 입력)
- 업종 카테고리 선택 (드롭다운)
- 사업자등록번호 입력 (10자리)
- 대표자명 입력 (선택)
- 임시저장 버튼 클릭 (선택)
- 제출 버튼 클릭

### 3.2 처리 (Process)
1. **필드 정규화**
   - 사업자등록번호: 하이픈 제거, 10자리 숫자 검증
   - 주소: 도로명/지번 주소 파싱
   - 업체명: 트림, 특수문자 제한

2. **사업자등록번호 검증**
   - 형식 검증: 10자리 숫자
   - 체크섬 알고리즘 검증 (한국 사업자번호 규칙)
   - 중복 검증: 동일 번호로 이미 가입된 계정 확인

3. **외부 API 검증 (선택)**
   - 국세청 사업자번호 조회 API 호출
   - 실제 사업자 존재 여부 확인
   - 타임아웃 시 검증 생략 또는 대기 상태로 전환

4. **Geocoding**
   - 주소로 위도/경도 좌표 추출
   - 지도 표시를 위한 좌표 저장

5. **프로필 저장**
   - `advertiser_profiles` 테이블 레코드 생성
   - 사업자 정보, 주소, 좌표 저장
   - `onboarding_completed` = true 업데이트

6. **비동기 검증 잡 큐잉**
   - 국세청 API 호출을 백그라운드 잡으로 처리
   - 검증 결과는 관리자 승인 또는 자동 반영

7. **중복 차단**
   - 동일 사업자번호 재가입 방지
   - 기존 계정 안내

8. **레이트 리밋**
   - 동일 IP에서 5분당 최대 3회 제출

### 3.3 출력 (Output)
- **성공 케이스**
  - 등록 완료 토스트 메시지
  - 광고주 대시보드(`/advertiser/campaigns`)로 리다이렉트
  - 빈 상태(Empty State) 화면: 첫 체험단 등록 유도

- **검증 상태 표시**
  - 사업자번호 검증 대기: 프로필에 "검증 중" 배지
  - 검증 성공: 정상 이용 가능
  - 검증 실패: 관리자 문의 안내

- **실패 케이스**
  - 사업자번호 형식 오류: 필드 하단 실시간 에러 메시지
  - 사업자번호 중복: 경고 메시지, 기존 계정 찾기 링크
  - 국세청 검증 실패: 안내 메시지 (존재하지 않는 사업자)
  - 주소 미입력: 필수 필드 에러
  - Geocoding 실패: 좌표 없이 진행, 지도 미표시

### 3.4 엣지케이스
- **EC1. 동일 사업자번호로 이미 가입된 계정**
  - 처리: DB 조회 시 중복 감지
  - 출력: 에러 메시지, 기존 계정 찾기 또는 고객센터 안내

- **EC2. 사업자번호 체크섬 검증 실패**
  - 처리: 알고리즘 적용하여 유효성 검증
  - 출력: 에러 메시지 (올바르지 않은 사업자번호)

- **EC3. 국세청 API 타임아웃**
  - 처리: API 호출 실패 감지, 재시도 (최대 2회)
  - 출력: 검증 생략하고 진행 또는 관리자 승인 대기 상태

- **EC4. 주소 검색 결과 없음**
  - 처리: 빈 결과 반환
  - 출력: 안내 메시지, 직접 입력 옵션

- **EC5. Geocoding 실패**
  - 처리: 좌표 추출 실패
  - 출력: 주소만 저장, 지도 미표시 (나중에 수동 보정 가능)

- **EC6. 업종 카테고리 미선택**
  - 처리: 필수 필드 검증
  - 출력: 에러 메시지, 드롭다운으로 포커스

- **EC7. 업체명 중복 (다른 사업자번호)**
  - 처리: 중복 허용 (동일 브랜드의 여러 지점 가능)
  - 출력: 경고 메시지 (선택: 계속 진행 또는 수정)

---

## 4. 홈 & 체험단 목록 탐색

### 4.1 입력 (Input)
- 홈페이지(`/`) 접속
- 필터 선택
  - 카테고리 (음식점/카페/뷰티/패션/기타)
  - 지역 (시/도 드롭다운)
- 정렬 선택 (최신순/마감임박순/인기순)
- 검색 키워드 입력
- 체험단 카드 클릭
- 페이지 스크롤 (무한 스크롤)

### 4.2 처리 (Process)
1. **초기 데이터 로드**
   - `campaigns` 테이블 조회
   - 조건: `status = 'recruiting'`, `end_date >= 현재 날짜`
   - 기본 정렬: `created_at DESC` (최신순)
   - 페이지네이션: 초기 20개

2. **각 체험단 데이터 포함**
   - id, title, thumbnail, category, location
   - max_applicants, 현재 지원자 수 (applications COUNT)
   - 마감일 (end_date), D-day 계산
   - 광고주 정보 (업체명)

3. **필터/정렬 적용**
   - 클라이언트에서 쿼리 파라미터 생성
   - 서버로 GET 요청 (`/?sort=latest&category=cafe&region=seoul`)
   - 동적 SQL 쿼리
     - 정렬: ORDER BY 절 변경
     - 카테고리: WHERE category = ?
     - 지역: WHERE location LIKE ?
     - 검색: WHERE title ILIKE ? OR description ILIKE ?

4. **무한 스크롤**
   - Intersection Observer로 하단 도달 감지
   - 다음 페이지 데이터 요청 (offset 또는 cursor)
   - 기존 리스트에 append

5. **배너 로드**
   - 상단 히어로 배너 (공지/추천 체험단)
   - 캐러셀 또는 정적 이미지

### 4.3 출력 (Output)
- **초기 로드**
  - 체험단 카드 그리드 렌더링 (2-3열)
  - 각 카드 정보:
    - 썸네일, 체험단명, 업체명
    - 카테고리 배지, 지역
    - 모집 인원 (예: "5/10명")
    - D-day 표시
    - "모집중" 배지
  - 로딩 스켈레톤 UI

- **필터/정렬 결과**
  - 리스트 업데이트 (애니메이션)
  - 결과 개수 표시
  - 빈 상태: 안내 메시지 + 필터 초기화 버튼

- **카드 클릭**
  - 체험단 상세 페이지(`/campaigns/:id`)로 이동

### 4.4 엣지케이스
- **EC1. 체험단 목록 비어있음**
  - 처리: 빈 배열 반환
  - 출력: 빈 상태 UI, 광고주라면 등록 유도

- **EC2. 필터링 결과 없음**
  - 처리: 조건에 맞는 데이터 없음
  - 출력: 빈 상태 UI, 필터 초기화 버튼

- **EC3. 무한 스크롤 끝**
  - 처리: has_more: false 반환
  - 출력: 로딩 숨김, 안내 메시지

- **EC4. 이미지 로드 실패**
  - 처리: 썸네일 404
  - 출력: placeholder 이미지 표시

- **EC5. 검색어 특수문자 (SQL Injection 시도)**
  - 처리: 입력값 sanitize, 파라미터 바인딩
  - 출력: 안전하게 검색 실행

- **EC6. 네트워크 타임아웃**
  - 처리: API 요청 실패
  - 출력: 에러 메시지, 재시도 버튼

---

## 5. 체험단 상세

### 5.1 입력 (Input)
- 체험단 카드 클릭 또는 URL 직접 접근
- 체험단 상세 페이지(`/campaigns/:id`) 진입
- 페이지 스크롤하여 정보 확인
- 이미지 갤러리 클릭 (선택)
- 지도에서 "길찾기" 클릭 (선택)
- 공유 버튼 클릭 (선택)
- "지원하기" 버튼 클릭

### 5.2 처리 (Process)
1. **체험단 데이터 조회**
   - `campaigns` 테이블에서 id로 단건 조회
   - JOIN `advertiser_profiles` (업체 정보)
   - 지원자 수 COUNT (applications)

2. **모집 정보 파싱**
   - 모집 기간 (start_date ~ end_date)
   - 모집 인원, 현재 지원자 수
   - 제공 혜택, 미션 (리치 텍스트)
   - 매장 정보 (주소, 좌표, 연락처, 영업시간)
   - 유의사항

3. **사용자 권한 확인**
   - 로그인 여부 체크
   - 역할 확인 (인플루언서인지)
   - 온보딩 완료 여부 (`onboarding_completed`)
   - 이미 지원했는지 확인 (applications 테이블)
   - 광고주 본인인지 확인

4. **조회수 증가**
   - `view_count` 컬럼 +1 (비동기)
   - (옵션) 쿠키로 중복 카운트 방지

5. **지도 렌더링**
   - 매장 좌표로 Kakao/Naver Map 표시
   - 마커 표시

### 5.3 출력 (Output)
- **페이지 렌더링**
  - 히어로 섹션: 대표 이미지 + 제목 + 상태 배지
  - 모집 정보 카드
  - 제공 혜택 섹션 (리치 텍스트)
  - 미션 섹션
  - 매장 정보: 지도, 주소, 연락처, 영업시간
  - 유의사항

- **CTA 버튼 조건부 표시**
  - 비로그인: "로그인하고 지원하기"
  - 인플루언서 + 온보딩 완료: "지원하기"
  - 이미 지원: "지원 완료" (비활성)
  - 광고주 본인: "지원자 관리"
  - 인플루언서 아님: "광고주는 지원할 수 없습니다" (비활성)

- **이미지 갤러리**
  - Lightbox 모달, 좌우 네비게이션

- **공유 기능**
  - 링크 복사: 클립보드 복사 완료 토스트
  - 카카오톡 공유: 메시지 템플릿 전송

### 5.4 엣지케이스
- **EC1. 존재하지 않는 체험단 ID**
  - 처리: 조회 결과 null
  - 출력: 404 페이지, 홈으로 돌아가기 버튼

- **EC2. 삭제된 체험단**
  - 처리: deleted_at 존재
  - 출력: 404 페이지

- **EC3. 모집 종료된 체험단**
  - 처리: status != 'recruiting'
  - 출력: "모집 종료" 배지, CTA 비활성화

- **EC4. 지도 로드 실패**
  - 처리: Map API 에러, 좌표 없음
  - 출력: 에러 메시지 또는 주소 텍스트만 표시

- **EC5. 비로그인 사용자가 "지원하기" 클릭**
  - 처리: 클릭 이벤트에서 로그인 체크
  - 출력: 로그인 페이지로 리다이렉트, 복귀 URL 저장

- **EC6. 광고주가 지원 시도**
  - 처리: 역할 체크
  - 출력: CTA 버튼 비활성화 + 안내 메시지

- **EC7. 공유 클립보드 API 미지원 브라우저**
  - 처리: fallback (textarea + execCommand)
  - 출력: 동일하게 복사 완료 토스트

---

## 6. 체험단 지원

### 6.1 입력 (Input)
- 체험단 상세 페이지에서 "지원하기" 버튼 클릭
- 지원 페이지(`/campaigns/:id/apply`) 진입
- 지원 폼 작성
  - 각오 한마디 입력 (텍스트 영역, 최대 500자)
  - 방문 예정일자 선택 (날짜 피커)
  - 활동할 SNS 채널 선택 (등록된 채널 중)
- 임시저장 버튼 클릭 (선택)
- 제출 버튼 클릭
- 확인 다이얼로그에서 "확인" 클릭

### 6.2 처리 (Process)
1. **접근 권한 검증**
   - 로그인 상태 확인
   - 역할: `role = 'influencer'`
   - 온보딩 완료: `onboarding_completed = true`

2. **중복 지원 체크**
   - applications 테이블 조회
   - WHERE campaign_id = ? AND influencer_id = ? AND status != 'rejected'

3. **체험단 상태 확인**
   - `status = 'recruiting'` 확인
   - `end_date >= 현재 날짜`
   - 모집 인원 초과 여부 (현재 지원자 수 vs max_applicants)

4. **입력값 검증**
   - 각오 한마디: 최소 10자, 최대 500자, 금지어 필터링 (옵션)
   - 방문 예정일: 현재 날짜 이후, 체험단 종료일 이후 불가
   - SNS 채널: 최소 1개 선택

5. **제출 처리**
   - 트랜잭션 시작
   - applications 테이블 INSERT
     - campaign_id, influencer_id
     - message, visit_date, selected_sns_channel
     - status = 'pending'
     - created_at = 현재 시간
   - campaigns.applicants_count +1 (또는 COUNT 계산)
   - 트랜잭션 커밋

6. **후속 작업**
   - 임시저장 데이터 삭제
   - (옵션) 광고주에게 새 지원자 알림 발송

### 6.3 출력 (Output)
- **권한 없음**
  - 비로그인: 로그인 페이지로 리다이렉트
  - 광고주: 에러 토스트 + 홈으로
  - 온보딩 미완료: 온보딩 페이지로

- **중복 지원**
  - 에러 모달: 이미 지원한 체험단
  - "내 지원 목록" 버튼

- **모집 종료/마감**
  - 에러 모달: 모집 종료 안내
  - "다른 체험단 보기" 버튼

- **지원 페이지 로드**
  - 상단: 체험단 요약 카드
  - 지원 폼 (글자 수 카운터)
  - "임시저장" / "제출하기" 버튼

- **실시간 검증 피드백**
  - 각오 한마디: 10자 미만 에러, 500자 초과 입력 차단
  - 방문 예정일: 과거 날짜 에러
  - SNS 채널 미선택: 제출 시 에러

- **제출 성공**
  - 성공 토스트
  - `/my/applications`로 리다이렉트
  - 방금 지원한 체험단 상단 표시

- **제출 실패**
  - 에러 토스트
  - 폼 상태 유지
  - "재시도" 버튼

### 6.4 엣지케이스
- **EC1. URL 직접 접근 (권한 없음)**
  - 처리: 미들웨어에서 세션 체크
  - 출력: 로그인 또는 홈으로 리다이렉트

- **EC2. 이미 지원한 체험단에 재지원**
  - 처리: 중복 체크
  - 출력: 경고 페이지, 내 지원 목록 링크

- **EC3. 반려된 체험단에 재지원**
  - 처리: 정책에 따라 허용/차단
  - 출력: 허용 시 새 레코드 생성, 차단 시 에러

- **EC4. 모집 인원 마감 (Race Condition)**
  - 처리: 트랜잭션 + SELECT FOR UPDATE
  - 출력: 에러 메시지 (방금 마감됨)

- **EC5. 등록된 SNS 채널 없음**
  - 처리: sns_channels 비어있음
  - 출력: 에러 + 프로필 수정 링크

- **EC6. 각오 한마디 공백만**
  - 처리: trim() 후 길이 체크
  - 출력: 에러 메시지

- **EC7. HTML/스크립트 삽입 시도**
  - 처리: XSS 방지 sanitize
  - 출력: 태그 제거된 텍스트 저장

- **EC8. 중복 제출 (더블 클릭)**
  - 처리: 버튼 즉시 비활성화
  - 출력: 로딩 인디케이터

- **EC9. 네트워크 끊김**
  - 처리: API 타임아웃
  - 출력: 에러 토스트, 재시도, 입력값 보존

- **EC10. 체험단 삭제됨**
  - 처리: 조회 시 null
  - 출력: 404 페이지

---

## 7. 내 지원 목록 (인플루언서 전용)

### 7.1 입력 (Input)
- 헤더/메뉴에서 "내 지원 목록" 클릭
- 내 지원 목록 페이지(`/my/applications`) 진입
- 상태별 탭 클릭 (전체/신청완료/선정/반려)
- 검색창에 체험단명 입력 (선택)
- 정렬 선택 (최신순/오래된순/마감임박순) (선택)
- 지원 내역 카드 클릭

### 7.2 처리 (Process)
1. **접근 권한 검증**
   - 로그인 상태, 역할 `influencer`, 온보딩 완료

2. **초기 데이터 로드**
   - applications 테이블 조회
   - WHERE influencer_id = 현재 사용자 ID
   - JOIN campaigns (체험단 정보)
   - JOIN advertiser_profiles (광고주 정보)
   - ORDER BY created_at DESC (기본: 최신순)
   - 페이지네이션 (초기 20개)

3. **상태별 카운트 계산**
   - GROUP BY status
   - 전체, pending, selected, rejected 개수

4. **탭 필터링**
   - 선택된 탭에 따라 WHERE status = ?

5. **검색/정렬**
   - 검색: WHERE campaigns.title ILIKE ?
   - 정렬: ORDER BY 절 변경

6. **페이지네이션**
   - 무한 스크롤 또는 페이지 버튼

### 7.3 출력 (Output)
- **권한 없음**
  - 비로그인: 로그인 페이지로
  - 광고주: 광고주 대시보드로

- **페이지 로드**
  - 탭 네비게이션 (뱃지에 개수)
  - 검색창, 정렬 드롭다운
  - 지원 내역 카드 리스트

- **카드 구조**
  - 체험단 썸네일, 제목, 광고주명
  - 카테고리 배지
  - 지원 날짜, 방문 예정일
  - 상태 배지 (색상 구분)
  - D-day 표시

- **빈 상태**
  - 전체 탭: 아직 지원 없음, "체험단 둘러보기" 버튼
  - 특정 탭: 해당 상태 없음
  - 검색 결과 없음: "검색 초기화" 버튼

- **탭 전환**
  - 활성 탭 하이라이트
  - 리스트 업데이트 (애니메이션)

- **카드 클릭**
  - 체험단 상세 페이지로 이동

### 7.4 엣지케이스
- **EC1. 권한 없음**
  - 처리: 역할 체크
  - 출력: 리다이렉트

- **EC2. 지원 내역 없음**
  - 처리: 빈 배열
  - 출력: 빈 상태 UI

- **EC3. 체험단 삭제됨**
  - 처리: JOIN 시 campaigns null
  - 출력: "삭제된 체험단" 표시 또는 숨김

- **EC4. 검색 결과 없음**
  - 처리: 빈 배열
  - 출력: 빈 상태 UI

- **EC5. 광고주 탈퇴**
  - 처리: advertiser_profiles null
  - 출력: "탈퇴한 사용자" 표시

- **EC6. 네트워크 타임아웃**
  - 처리: API 실패
  - 출력: 에러 + 재시도 버튼

---

## 8. 광고주 체험단 관리

### 8.1 입력 (Input)
- 헤더/메뉴에서 "체험단 관리" 클릭
- 체험단 관리 페이지(`/advertiser/campaigns`) 진입
- 통계 카드 확인
- 상태별 필터 선택 (전체/모집중/모집종료/선정완료/종료)
- 검색창에 체험단명 입력 (선택)
- 정렬 선택 (최신순/오래된순/마감임박순/지원자많은순) (선택)
- 뷰 모드 전환 (카드/테이블) (선택)
- "새 체험단 등록" 버튼 클릭
- 특정 체험단에서 "상세보기/수정/삭제" 클릭

### 8.2 처리 (Process)
1. **접근 권한 검증**
   - 로그인, 역할 `advertiser`, 온보딩 완료

2. **통계 데이터 계산**
   - campaigns 테이블 조회 (WHERE advertiser_id = 현재 사용자)
   - 총 체험단 수, 진행 중, 총 지원자 수

3. **체험단 목록 로드**
   - WHERE advertiser_id = 현재 사용자
   - JOIN applications (지원자 수)
   - ORDER BY created_at DESC (기본)
   - 페이지네이션 (초기 20개)

4. **상태별 필터링**
   - WHERE status = ?

5. **검색/정렬**
   - 검색: WHERE title ILIKE ?
   - 정렬: ORDER BY 절 변경

6. **삭제 처리**
   - 확인 다이얼로그 표시
   - 지원자/선정 인원 확인
   - 소프트 삭제: deleted_at 업데이트
   - 또는 하드 삭제: DELETE
   - 관련 이미지 Storage에서 삭제

### 8.3 출력 (Output)
- **권한 없음**
  - 비로그인: 로그인 페이지로
  - 인플루언서: 홈으로

- **페이지 로드**
  - 통계 카드 (총 체험단, 진행 중, 총 지원자)
  - "새 체험단 등록" 버튼
  - 필터/검색/정렬/뷰 모드 영역
  - 체험단 목록 (카드 또는 테이블)

- **카드 뷰**
  - 썸네일, 제목, 카테고리, 상태 배지
  - 모집 기간, 지원자 현황
  - D-day, 액션 버튼

- **테이블 뷰**
  - 컬럼: 썸네일, 제목, 카테고리, 상태, 모집 기간, 지원자 수, 등록일, 액션

- **빈 상태**
  - 목록 없음: 첫 체험단 등록 유도
  - 특정 상태 없음: 해당 상태 없음 메시지
  - 검색 결과 없음: 검색 초기화 버튼

- **삭제 성공**
  - 성공 토스트
  - 리스트에서 제거 (애니메이션)
  - 통계 업데이트

- **삭제 실패**
  - 에러 토스트 (선정 인원 있음 등)

### 8.4 엣지케이스
- **EC1. 권한 없음**
  - 처리: 역할 체크
  - 출력: 리다이렉트

- **EC2. 체험단 없음**
  - 처리: 빈 배열
  - 출력: 빈 상태 UI

- **EC3. 선정 인원 있는데 삭제 시도**
  - 처리: applications에서 status = 'selected' 확인
  - 출력: 에러 다이얼로그 (삭제 불가)

- **EC4. 지원자 있는데 삭제 시도**
  - 처리: 정책에 따라 허용/차단
  - 출력: 경고 메시지

- **EC5. 썸네일 로드 실패**
  - 처리: 이미지 404
  - 출력: placeholder 표시

- **EC6. 네트워크 에러**
  - 처리: API 실패
  - 출력: 에러 + 재시도

---

## 9. 광고주 체험단 상세 & 모집 관리

### 9.1 입력 (Input)
- 체험단 관리에서 "상세보기" 클릭
- 광고주용 상세 페이지(`/advertiser/campaigns/:id`) 진입
- 체험단 정보 확인
- 지원자 리스트 테이블 확인
- 지원자 정보 클릭 (SNS 링크, 각오 한마디 펼치기)
- 지원자 필터링/정렬 (선택)
- 상태별 액션 버튼 클릭
  - 모집중: "모집 종료" 버튼
  - 모집종료: "체험단 선정" 버튼
- "모집 종료" 확인 다이얼로그에서 "확인"
- "체험단 선정" Dialog에서 지원자 체크박스 선택
- "선정 완료" 버튼 클릭
- 선정 확인 다이얼로그에서 "확인"

### 9.2 처리 (Process)
1. **접근 권한 검증**
   - 로그인, 역할 `advertiser`
   - 체험단 소유권: campaigns.advertiser_id = 현재 사용자

2. **체험단 데이터 로드**
   - campaigns 테이블 단건 조회
   - 모든 필드, 이미지 URL

3. **지원자 리스트 로드**
   - applications 테이블 조회 (WHERE campaign_id = ?)
   - JOIN influencer_profiles, users
   - ORDER BY created_at DESC
   - 페이지네이션 (초기 50개)

4. **지원자 통계 계산**
   - 전체, pending, selected, rejected 개수

5. **지원자 필터/정렬**
   - 상태별: WHERE status = ?
   - 검색: WHERE name ILIKE ?
   - 정렬: ORDER BY created_at/visit_date

6. **모집 종료 처리**
   - 확인 다이얼로그
   - campaigns 테이블 UPDATE
   - SET status = 'ended' WHERE id = ? AND status = 'recruiting'

7. **체험단 선정 처리**
   - 선정 가능 확인: status = 'ended', 지원자 존재
   - 선정 Dialog 표시
   - 선택 인원 카운트
   - 트랜잭션 시작:
     - applications UPDATE: status = 'selected' (선택된 지원자)
     - applications UPDATE: status = 'rejected' (선택 안 된 지원자)
     - campaigns UPDATE: status = 'completed'
   - 트랜잭션 커밋

8. **후속 작업**
   - 선정/반려 인플루언서에게 알림 발송 (이메일/푸시)
   - 로그 기록

### 9.3 출력 (Output)
- **권한 없음**
  - 비로그인: 로그인 페이지로
  - 인플루언서: 홈으로
  - 다른 광고주: 403 페이지

- **체험단 없음**
  - 404 페이지

- **페이지 로드**
  - 상단: 체험단 요약 카드
  - 상태별 액션 버튼
  - 지원자 통계
  - 지원자 테이블

- **지원자 테이블**
  - 컬럼: 체크박스(선정 모드), 순번, 이름, SNS 채널, 각오 한마디, 방문 예정일, 지원일, 상태
  - 페이지네이션

- **지원자 없음**
  - 빈 상태 UI

- **SNS 채널**
  - 아이콘 + 링크 (새 탭)
  - 툴팁으로 URL 표시

- **각오 한마디**
  - 50자 말줄임, 호버/클릭으로 전체 보기

- **모집 종료 다이얼로그**
  - 경고 메시지
  - 확인/취소

- **모집 종료 성공**
  - 성공 토스트
  - 상태: "모집중" → "모집종료"
  - 버튼: "모집 종료" → "체험단 선정"

- **선정 Dialog**
  - 모달 (크게)
  - 안내: 모집 인원, 선택 인원 실시간 카운트
  - 지원자 체크박스 리스트
  - 초과 시 경고
  - "선정 완료" 버튼 (0명이면 비활성)

- **체크박스 피드백**
  - 체크 시 하이라이트
  - 카운트 업데이트
  - 초과 시 경고색

- **선정 확인 다이얼로그**
  - 선택된 인원 목록
  - 확인 메시지
  - 확인/취소

- **선정 완료 성공**
  - 성공 토스트
  - 상태: "모집종료" → "선정완료"
  - 테이블 업데이트 (선정/반려 상태)
  - 선정 인원 섹션 추가 (상단)

- **선정 실패**
  - 에러 토스트
  - Dialog 유지, 재시도

### 9.4 엣지케이스
- **EC1. 권한 없음**
  - 처리: 역할/소유권 체크
  - 출력: 리다이렉트 또는 403

- **EC2. 체험단 삭제됨**
  - 처리: 조회 null
  - 출력: 404

- **EC3. 지원자 없는데 "모집 종료"**
  - 처리: 허용
  - 출력: 경고 메시지 (지원자 없음, 계속?)

- **EC4. 지원자 없는데 "체험단 선정"**
  - 처리: 버튼 비활성화
  - 출력: 에러 메시지

- **EC5. "모집 종료" 중복 클릭**
  - 처리: 버튼 즉시 비활성화
  - 출력: 로딩

- **EC6. 이미 종료된 체험단 재종료 시도**
  - 처리: status 체크
  - 출력: 에러 (이미 종료됨)

- **EC7. 선정 시 아무도 선택 안함**
  - 처리: 선택 인원 0 체크
  - 출력: 버튼 비활성화 또는 에러

- **EC8. 선정 시 모집 인원 초과**
  - 처리: 허용 (정책에 따라)
  - 출력: 경고 메시지 (초과, 계속?)

- **EC9. 선정 중 네트워크 에러**
  - 처리: API 실패
  - 출력: 에러 + 재시도, Dialog 유지

- **EC10. 선정 중 지원자 탈퇴**
  - 처리: 트랜잭션 롤백 또는 해당 지원자 제외
  - 출력: 경고 (일부 선정 실패)

- **EC11. 선정 완료 후 재선정 시도**
  - 처리: status 체크
  - 출력: 에러 (이미 선정 완료)

- **EC12. SNS 링크 404**
  - 처리: 링크 제공 (검증 안함)
  - 출력: 클릭 시 브라우저에서 에러 확인

- **EC13. 각오 한마디 매우 긴 경우**
  - 처리: 말줄임
  - 출력: 모달/툴팁으로 전체 보기

- **EC14. 지원자 매우 많음 (수백 명)**
  - 처리: 페이지네이션, 인덱싱
  - 출력: 빠른 로딩

- **EC15. 선정 Dialog에서 ESC/외부 클릭**
  - 처리: Dialog 닫기 방지 또는 확인
  - 출력: 경고 (선택 내용 저장 안됨)

---

## 최종 요약

### 인플루언서 경로
1. 회원가입 & 역할선택 → 인플루언서
2. 인플루언서 정보 등록 (생년월일, SNS 채널)
3. 홈 & 체험단 목록 탐색
4. 체험단 상세 조회
5. 체험단 지원 (각오 한마디, 방문 예정일)
6. 내 지원 목록 관리 (신청완료/선정/반려)

### 광고주 경로
1. 회원가입 & 역할선택 → 광고주
2. 광고주 정보 등록 (업체명, 사업자번호, 주소)
3. 광고주 체험단 관리 (체험단 목록, 등록)
4. 광고주 체험단 상세 & 모집 관리 (지원자 조회, 모집 종료, 선정)

---

## 공통 원칙

### 보안
- 모든 입력값 검증 및 sanitize
- SQL Injection, XSS 방지
- 레이트 리밋, 봇 방지
- 역할 기반 접근 제어 (RBAC)
- Row Level Security (RLS)

### 성능
- 페이지네이션/무한 스크롤
- 인덱싱 (DB)
- 이미지 최적화 (리사이징, CDN)
- 캐싱 (React Query)
- 비동기 처리 (검증 잡)

### UX
- 실시간 입력 검증 피드백
- 로딩 인디케이터
- 에러 메시지 명확성
- 빈 상태 UI
- 토스트/다이얼로그 일관성
- 반응형 디자인

### 데이터 정합성
- 트랜잭션 사용
- 낙관적 잠금 (동시성 제어)
- 중복 방지
- Cascade/Soft Delete 정책

---

## 부록: 상태 전이도

### 체험단 상태 (campaigns.status)
```
[등록] → recruiting (모집중)
  ↓
[모집 종료] → ended (모집종료)
  ↓
[체험단 선정] → completed (선정완료)
  ↓
[운영 종료] → closed (종료)
```

### 지원 상태 (applications.status)
```
[지원] → pending (신청완료)
  ↓
[선정 프로세스] → selected (선정) 또는 rejected (반려)
```

---

## 문서 버전
- 버전: 1.0
- 최종 수정일: 2025-09-30
- 작성자: PRD 기준 유저플로우 정의